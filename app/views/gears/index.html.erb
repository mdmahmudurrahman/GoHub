<div class="featured-ride-providers">
  <div class="container">

  <div class="gears-display-top-div">
    <span id="map-show-btn" class="map-show-btn" onclick="showMapDiv()">Map</span>
  </div>
    <div id="gears-display" class="col-md-8 gears-display-no-padding">
      <%
      date_params = params[:datefilter]
      date_params = date_params.split " - "
      lat_long = []

        @shops.each do |shop|
          shop_location = {
            "title": shop.name,
            "lat": shop.latitude,
            "lng": shop.longitude,
            "description": "Details"
          }

          gears = shop.gears.search_by_category(params[:category]).search_gear(params[:quantity], date_params[0], date_params[1])

          if gears.length > 0
            lat_long.push shop_location
          end

          gears.each do |gear|
            bike_img = gear.img_path ? gear.img_path : "home_page/intro_image.jpg"
          %>
          <div class="col-md-6 wow fadeInDown gear-display-no-padding">
            <%= image_tag(bike_img, class: "img-responsive bike_img") %>
            <div class="gear-details">
              <span class="gear-title">$<%= gear.price_per_day.to_i %> <%= gear.title.truncate 50 %></span>
              <span class="gear-details">Frame size 190-182 cm</span>
            </div>
            <span class="rating">
              <span><i class="fa fa-star" aria-hidden="true"></i></span>
              <span><i class="fa fa-star" aria-hidden="true"></i></span>
              <span><i class="fa fa-star" aria-hidden="true"></i></span>
              <span><i class="fa fa-star" aria-hidden="true"></i></span>
              <span><i class="fa fa-star-half-o" aria-hidden="true"></i></span>
            </span>
            <span class="gear-reviews"><%= shop.reviews.count %> Reviews</span>
          </div>
        <% end %>
      <% end %>

    </div>

    <div class="col-md-4 gears-display-no-padding">
      <div class="map-button-div" id="map-button-div">
        <button id="map-close-btn" class="btn-default map-close-btn" onclick="hideMapDiv()">CLOSE</button>
      </div>
      <div id="dvMap" class="dv-map"></div>
    </div>

  </div>
</div>

<!-- <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBArxTME6txFlxQd-X0AaYuJWEiEuCWB94" type="text/javascript"></script> -->
<script type="text/javascript">
  var markers =  <%= raw lat_long.to_json %>;

  window.onload = function () {
    var mapOptions = {
      center: {lat: -34.397, lng: 150.644},
      zoom: 8
      // mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    var map = new google.maps.Map(document.getElementById("dvMap"), mapOptions);
    var infoWindow = new google.maps.InfoWindow();
    var lat_lng = new Array();
    var latlngbounds = new google.maps.LatLngBounds();

    for (i = 0; i < markers.length; i++) {
      var data = markers[i]
      var myLatlng = new google.maps.LatLng(data.lat, data.lng);
      lat_lng.push(myLatlng);
      var marker = new google.maps.Marker({
        position: myLatlng,
        map: map,
        title: data.title
      });
      latlngbounds.extend(marker.position);
      (function (marker, data) {
        google.maps.event.addListener(marker, "click", function (e) {
        infoWindow.setContent(data.description);
        infoWindow.open(map, marker);
        });
      })(marker, data);
    }
    map.setCenter(latlngbounds.getCenter());
    map.fitBounds(latlngbounds);
  }

  function hideMapDiv() {
    document.getElementById('dvMap').style.display = 'none';
    document.getElementById('map-button-div').style.display = 'none';

    document.getElementById('map-show-btn').style.display = 'block';
    document.getElementById("gears-display").className = "col-md-12 gears-display-no-padding";
  }

  function showMapDiv() {
    document.getElementById('dvMap').style.display = 'block';
    document.getElementById('map-button-div').style.display = 'block';

    document.getElementById('map-show-btn').style.display = 'none';
    document.getElementById("gears-display").className = "col-md-8 gears-display-no-padding";
  }
</script>

